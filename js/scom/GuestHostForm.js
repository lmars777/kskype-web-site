define("scom/GuestHostForm",["apollo/document","apollo/window","window","apollo/Button","apollo/scroll","apollo/settings","apollo/ajax","apollo/keycodes","apollo/responsive","apollo/tracking","apollo/tracking.aria","apollo/cookie","jquery","domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){"use strict";var n="active",o="activeGuestHostForm",p="inProgress",q="afterFailure",r=".closeButton",s=".btn",t=".inputGroup",u=".errorMessage",v=".lightForm",w=".formContent",x=".formWaiting",y="#formWaitingHeading",z=".formFailure",A="error",B=".tooltipMessage",C="error-long",D=50,E="#pageTop",F=400,G="hero",H="guest_host_open",I="guest_host_close",J="guest_host_success",K="guest_host_progress",L="guest_host_failed",M="gh_validation_failure_empty",N="gh_validation_failure_toolong",O=!1,P="guest_host_returninguser",Q="guest_host_newuser",R="guestHostVisitor",S={INACTIVE:0,ACTIVE:1,INPROGRESS:2,FAILED:3},T="",U="none",V=function(a,b,c,e,f,g){this.formWrapperjQElement=m(a),this.parentSectionjQElement=this.formWrapperjQElement.closest("section"),this.formjQElement=this.formWrapperjQElement.find(v),this.inputjQElement=m(b),this.inputValidationMessagejQElement=this.inputjQElement.parents(t).find(u),this.closeButtonjQElement=this.formWrapperjQElement.find(r),this.submitButtonjQElement=m(c),this.submitButton=new d(c),this.openingButtonjQElement=m(e),this.openingCallback=f,this.closingCallback=g,W.call(this)};V.prototype.isActive=function(){return!!this.formWrapperjQElement&&this.formWrapperjQElement.hasClass(n)&&i.isDesktop()},V.prototype.isInProgress=function(){return!!this.formjQElement&&this.formjQElement.hasClass(p)},V.prototype.setStatus=function(a,b){var d=!!b;switch(a){case S.INACTIVE:d||j.trackCustomImpressionEvent(G,I),this.formWrapperjQElement.removeClass(n),this.parentSectionjQElement.removeClass(o),this.formjQElement.removeClass(p),this.formjQElement.removeClass(q),fa.call(this,v,"hide");break;case S.ACTIVE:d||j.trackCustomImpressionEvent(G,H),this.formjQElement.removeClass(p),this.formjQElement.removeClass(q),this.formWrapperjQElement.addClass(n),this.parentSectionjQElement.addClass(o),qa.call(this,w),c.setTimeout(X.bind(this,this.inputjQElement),F);break;case S.INPROGRESS:d||j.trackCustomImpressionEvent(G,K),this.formjQElement.removeClass(q),this.formjQElement.addClass(p),this.formWrapperjQElement.addClass(n),this.parentSectionjQElement.addClass(o),qa.call(this,x),X(this.formjQElement.find(y));break;case S.FAILED:d||j.trackCustomImpressionEvent(G,L),this.formjQElement.removeClass(p),this.formjQElement.addClass(q),this.formWrapperjQElement.addClass(n),this.parentSectionjQElement.addClass(o),qa.call(this,z),this.closeButtonjQElement.focus()}};var W=function(){var a=this;m("#form").submit(function(a){a.preventDefault()}),this.openingButtonjQElement&&da.call(a),i.on(i.DESKTOP_OFF,function(){a.formWrapperjQElement.hasClass(n)&&ea.call(a)}),this.setStatus(S.INACTIVE,!0)},X=function(a){var c=b.getX(),d=b.getY();a.focus(),b.scrollImmediate(c,d)},Y=function(){var b={name:m.trim(this.inputjQElement.val()),lang:a.getLanguage(),sessionid:T,greeniddc:U};g.post({beforeSend:ga.bind(this),url:f.guestHost.skypeguestHostBackEndUrl,data:b,success:na.bind(this),error:oa.bind(this),xhrFields:{withCredentials:!0}})},Z=function(){var a="aaaaaaaa-aaaa-4aaa-baaa-aaaaaaaaaaaa".replace(/[ab]/g,function(a){var b=(new Date).getTime(),c=Math.random(),d=(b+16*c)%16|0;b=Math.floor(b/16);var e="a";return(a==e?d:3&d|8).toString(16)});return a},$=function(a){return!!a.originalEvent&&f.guestHost.skypeguestHostGreenIdUrl.indexOf(a.originalEvent.origin)>-1},_=function(){if(f.guestHost.skypeguestHostGreenIdEnabled&&!T){T=Z(),b.on("message",function(a){$(a)?"string"==typeof a.originalEvent.data?(U=a.originalEvent.data,k.logEvent("greenIdMessageHandlerSuccess")):k.logEvent("greenIdMessageHandlerNonStringData"):k.logEvent("greenIdMessageHandlerWrongOrigin")});var a=document.createElement("iframe");a.id="greenIdFrame",a.className="offscreen",k.logEvent("greenIdFrameLoadStart"),a.src=f.guestHost.skypeguestHostGreenIdUrl+"/tags?session_id="+T,document.body.appendChild(a)}this.inputjQElement.val("").attr("aria-invalid",!1),this.openingButtonjQElement.attr("tabindex",-1).attr("aria-hidden",!0),this.submitButton.disable(),ka(this.inputjQElement,this.inputValidationMessagejQElement),ba.call(this),this.setStatus(S.ACTIVE),this.openingCallback&&this.openingCallback()},aa=function(a,b){a.on("keyup click",function(a){return a.which===h.ENTER||"click"===a.type?(a.preventDefault(),b(a),!1):void 0})},ba=function(){var b=this;aa(this.closeButtonjQElement,function(){b.isInProgress()||ea.call(b)}),this.inputjQElement.on({keyup:function(a){return a.keyCode===h.ENTER?ia.call(b):ha.call(b),!1}}),aa(this.submitButtonjQElement,ia.bind(b)),this.parentSectionjQElement.on("click touchstart",function(a){return 0!==b.formWrapperjQElement.find(a.target).length||b.openingButtonjQElement.is(a.target)||!b.isActive()||b.isInProgress()?void 0:(ea.call(b),!1)}),a.jQElement.on("keydown.closingGuestHostForm",function(a){return b.isActive()&&!b.isInProgress()&&a.which===h.ESCAPE?(ea.call(b),!1):void 0})},ca=function(){this.closeButtonjQElement.off("click keyup"),this.inputjQElement.off("keyup"),this.submitButtonjQElement.off("click keyup"),this.parentSectionjQElement.off("click touchstart"),a.jQElement.off("keydown.closingGuestHostForm")},da=function(){var a=this;this.openingButtonjQElement&&aa(this.openingButtonjQElement,function(b){return a.clickedOpeningButtonjQElement=m(b.target).closest(s),e(E).smoothTo({complete:_.call(a)}),!1})},ea=function(){var a=this;ca.call(this),this.setStatus(S.INACTIVE),this.openingButtonjQElement.attr("tabindex",0).attr("aria-hidden",!1),e(a.clickedOpeningButtonjQElement.closest("section")).smoothTo({complete:function(){c.setTimeout(function(){X(a.clickedOpeningButtonjQElement)},F/5)}}),this.closingCallback&&this.closingCallback()},fa=function(a,b){"show"===b?(this.formWrapperjQElement.find(a).find("[tabindex]").attr("tabindex",0).attr("aria-hidden",!1),this.closeButtonjQElement.attr("tabindex",0).attr("aria-hidden",!1)):"hide"===b&&(this.formWrapperjQElement.find(a).find("[tabindex]").attr("tabindex",-1).attr("aria-hidden",!0),this.closeButtonjQElement.attr("tabindex",-1).attr("aria-hidden",!0))},ga=function(){this.setStatus(S.INPROGRESS)},ha=function(){var a=m.trim(this.inputjQElement.val());return this.submitButton.disable(),this.submitButtonjQElement.attr("aria-disabled",!0),a?a.length>D?(V.TRACKING_VALIDATION_TOOLONG_IS_TRACKED||(j.trackCustomImpressionEvent(G,N),V.TRACKING_VALIDATION_TOOLONG_IS_TRACKED=!0),ja(this.inputjQElement,this.inputValidationMessagejQElement,this.inputValidationMessagejQElement.find(B),this.inputValidationMessagejQElement.data(C)),!1):(ka(this.inputjQElement,this.inputValidationMessagejQElement),this.submitButton.enable(),this.submitButtonjQElement.attr("aria-disabled",!1),!0):(j.trackCustomImpressionEvent(G,M),this.inputjQElement.attr("aria-invalid",!0),!1)},ia=function(){ha.call(this)===!0&&Y.call(this)},ja=function(a,b,c,d){c.text(d),a.hasClass(A)||(a.addClass(A),a.attr("aria-invalid",!0),b.fadeIn("normal",function(){m(this).attr("aria-hidden",!1)}))},ka=function(a,b){a.hasClass(A)&&(a.removeClass(A),a.attr("aria-invalid",!1),b.fadeOut("normal",function(){m(this).attr("aria-hidden",!0)}))},la=function(){var b=2592e6,c={path:"/",domain:"."+a.getDomainName(),expiry:b},d=l.createSingleValue(R,1);d.store(c)},ma=function(){var a=l.exists(R),b=a?P:Q;la(),j.trackCustomImpressionEvent(G,b)},na=function(a){ma(),j.trackCustomImpressionEvent(G,J),c.setTimeout(pa.bind(this,a),f.guestHost.skypeguestHostDelayToRedirect||1)},oa=function(){this.setStatus(S.FAILED)},pa=function(a){var b=f.guestHost.skypewebClientLauncherUrl,c=b+"?threadId=19%3A"+a.ThreadId,d=m(document.createElement("form"));d.attr("id","formLauncher"),d.attr("method","POST"),d.attr("action",c);var e=m(document.createElement("input"));e.attr("type","hidden"),e.attr("name","skypetoken"),e.attr("id","skypetoken"),e.attr("value",a.SkypeToken),d.append(e),d.appendTo("body").submit()},qa=function(a){var b=this,c=[],d=b.closeButtonjQElement.get(0),e=d,f=d;fa.call(this,v,"hide"),fa.call(this,a,"show"),c=m(a).find("[tabindex]"),c&&c.size()>0&&(e=c.get(0),f=c.get(c.size()-1)),this.formWrapperjQElement.off("keydown.lockFocus"),this.formWrapperjQElement.on("keydown.lockFocus",function(a){var b=a.which,c=!0;if(b===h.TAB)if(c=!a.shiftKey){if(a.target===d)return m(e).focus(),a.stopPropagation(),!1;if(a.target===f)return m(d).focus(),a.stopPropagation(),!1}else{if(a.target===e)return m(d).focus(),a.stopPropagation(),!1;if(a.target===d)return m(f).focus(),a.stopPropagation(),!1}})};return V.STATUS=S,V.TRACKING_VALIDATION_TOOLONG_IS_TRACKED=O,V});